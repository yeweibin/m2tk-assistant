<?xml version = "1.0" encoding = "UTF-8"?>
<M2TKTemplate>
    <TableTemplate name="eb_index_section" group="EB-T/EBIndex">
        <TableId id="0xFD">
            <DisplayName str="应急广播索引表"/>
        </TableId>
        <TableBody>
            <Field name="table_id" length="8" encoding="uimsbf"/>
            <Field name="section_syntax_indicator" length="1" encoding="bslbf"/>
            <Field name="1" length="1" encoding="bslbf"/>
            <Field name="reserved" length="2" encoding="bslbf"/>
            <Field name="section_length" length="12" encoding="uimsbf">
                <FieldPresentation>
                    <Prefix str="段长度"/>
                </FieldPresentation>
            </Field>
            <Field name="table_id_ext" length="16" encoding="uimsbf"/>
            <Field name="reserved" length="2" encoding="bslbf"/>
            <Field name="version_number" length="5" encoding="bslbf">
                <FieldPresentation>
                    <Prefix str="版本号"/>
                    <Format str="%d"/>
                </FieldPresentation>
            </Field>
            <Field name="current_next_indicator" length="1" encoding="bslbf"/>
            <Field name="section_number" length="8" encoding="uimsbf">
                <FieldPresentation>
                    <Prefix str="当前分段号"/>
                </FieldPresentation>
            </Field>
            <Field name="last_section_number" length="8" encoding="uimsbf">
                <FieldPresentation>
                    <Prefix str="最后分段号"/>
                </FieldPresentation>
            </Field>
            <Field name="EBM_number" length="8" encoding="uimsbf"/>
            <Loop name="ebm_loop" length_field="EBM_number" length_type="count">
                <LoopPresentation>
                    <LoopHeader str="EBM描述"/>
                    <LoopEmpty str="***无EBM描述***"/>
                    <LoopEntry>
                        <Prefix str="消息描述"/>
                    </LoopEntry>
                </LoopPresentation>
                <Body>
                    <Field name="EBM_length" length="16" encoding="uimsbf"/>
                    <Field name="reserved" length="4" encoding="bslbf"/>
                    <Field name="EBM_id" length="35" encoding="nibbles">
                        <FieldPresentation>
                            <Prefix str="EBM_id"/>
                            <Format str="compact, lowercase"/>
                        </FieldPresentation>
                    </Field>
                    <Field name="EBM_original_network_id" length="16" encoding="uimsbf">
                        <FieldPresentation>
                            <Prefix str="EBM原始网络号"/>
                        </FieldPresentation>
                    </Field>
                    <Field name="EBM_start_time" length="40" encoding="bslbf">
                        <FieldPresentation>
                            <Prefix str="EBM开始时间"/>
                            <Mapping>
                                <DVBTime/>
                            </Mapping>
                        </FieldPresentation>
                    </Field>
                    <Field name="EBM_end_time" length="40" encoding="bslbf">
                        <FieldPresentation>
                            <Prefix str="EBM结束时间"/>
                            <Mapping>
                                <DVBTime/>
                            </Mapping>
                        </FieldPresentation>
                    </Field>
                    <Field name="EBM_type" length="10" encoding="nibbles">
                        <FieldPresentation>
                            <Prefix str="EBM类别"/>
                            <Format str="compact, lowercase"/>
                        </FieldPresentation>
                    </Field>
                    <Field name="EBM_class" length="4" encoding="bslbf">
                        <FieldPresentation>
                            <Prefix str="EBM分类"/>
                            <Mapping>
                                <Value value="1">
                                    <ValString str="发布系统演练"/>
                                </Value>
                                <Value value="2">
                                    <ValString str="模拟演练"/>
                                </Value>
                                <Value value="3">
                                    <ValString str="实际演练"/>
                                </Value>
                                <Value value="4">
                                    <ValString str="应急广播"/>
                                </Value>
                            </Mapping>
                        </FieldPresentation>
                    </Field>
                    <Field name="EBM_level" length="4" encoding="bslbf">
                        <FieldPresentation>
                            <Prefix str="EBM级别"/>
                            <Mapping>
                                <Value value="1">
                                    <ValString str="1级（特别重大）"/>
                                </Value>
                                <Value value="2">
                                    <ValString str="2级（重大）"/>
                                </Value>
                                <Value value="3">
                                    <ValString str="3级（较大）"/>
                                </Value>
                                <Value value="4">
                                    <ValString str="4级（一般）"/>
                                </Value>
                            </Mapping>
                        </FieldPresentation>
                    </Field>
                    <Field name="EB_resource_number" length="8" encoding="uimsbf"/>
                    <Loop name="EB_resource_loop" length_field="EB_resource_number" length_type="count">
                        <LoopPresentation>
                            <LoopHeader str="EBR描述"/>
                            <LoopEmpty str="***无EBR描述***"/>
                            <LoopEntry>
                                <Prefix str="资源描述"/>
                            </LoopEntry>
                        </LoopPresentation>
                        <Body>
                            <Field name="reserved" length="4" encoding="bslbf"/>
                            <Field name="EB_resource_code" length="23" encoding="nibbles">
                                <FieldPresentation>
                                    <Prefix str="资源编码"/>
                                    <Format str="compact, lowercase"/>
                                </FieldPresentation>
                            </Field>
                        </Body>
                    </Loop>
                    <Field name="reserved" length="7" encoding="bslbf"/>
                    <Field name="details_channel_indicate" length="1" encoding="bslbf"/>
                    <If>
                        <Condition>
                            <CompareWithConst field="details_channel_indicate" comp_op="equals" const="1"/>
                        </Condition>
                        <Then>
                            <Field name="details_channel_network_id" length="16" encoding="uimsbf">
                                <FieldPresentation>
                                    <Prefix str="指定频道网络号"/>
                                </FieldPresentation>
                            </Field>
                            <Field name="details_channel_transport_stream_id" length="16" encoding="uimsbf">
                                <FieldPresentation>
                                    <Prefix str="指定频道传输流号"/>
                                </FieldPresentation>
                            </Field>
                            <Field name="details_channel_program_number" length="16" encoding="uimsbf">
                                <FieldPresentation>
                                    <Prefix str="指定频道节目号"/>
                                </FieldPresentation>
                            </Field>
                            <Field name="reserved" length="3" encoding="bslbf"/>
                            <Field name="details_channel_PCR_PID" length="13" encoding="uimsbf">
                                <FieldPresentation>
                                    <Prefix str="指定频道PCR位置"/>
                                    <Format str="pid = 0x%04X (%d)"/>
                                </FieldPresentation>
                            </Field>
                            <Field name="reserved" length="4" encoding="bslbf"/>
                            <Field name="details_channel_program_info_length" length="12" encoding="uimsbf"/>
                            <Loop name="details_channel_program_info_loop" length_field="details_channel_program_info_length">
                                <LoopPresentation>
                                    <LoopHeader str="节目信息描述"/>
                                    <LoopEmpty str="***无节目信息描述***"/>
                                </LoopPresentation>
                                <Body>
                                    <Descriptor/>
                                </Body>
                            </Loop>
                            <Field name="stream_info_length" length="16" encoding="uimsbf"/>
                            <Loop name="elementary_stream_loop" length_field="stream_info_length">
                                <LoopPresentation>
                                    <LoopHeader str="节目基本流"/>
                                    <LoopEmpty str="***无节目基本流***"/>
                                    <LoopEntry>
                                        <Prefix str="基本流"/>
                                    </LoopEntry>
                                </LoopPresentation>
                                <Body>
                                    <Field name="stream_type" length="8" encoding="uimsbf">
                                        <FieldPresentation>
                                            <Prefix str="流类型"/>
                                            <Format str="%d"/>
                                            <Mapping>
                                                <Value value="1">
                                                    <ValString str="MPEG-1 视频"/>
                                                </Value>
                                                <Value value="2">
                                                    <ValString str="MPEG-2 视频"/>
                                                </Value>
                                                <Value value="3">
                                                    <ValString str="MPEG-1 音频"/>
                                                </Value>
                                                <Value value="4">
                                                    <ValString str="MPEG-2 音频"/>
                                                </Value>
                                                <Value value="5">
                                                    <ValString str="ISO 13818-1 私有段"/>
                                                </Value>
                                                <Value value="6">
                                                    <ValString str="ISO 13818-1 PES包"/>
                                                </Value>
                                            </Mapping>
                                        </FieldPresentation>
                                    </Field>
                                    <Field name="reserved" length="3" encoding="bslbf"/>
                                    <Field name="elementary_PID" length="13" encoding="uimsbf">
                                        <FieldPresentation>
                                            <Prefix str="基本流位置"/>
                                            <Format str="pid = 0x%04X (%d)"/>
                                        </FieldPresentation>
                                    </Field>
                                    <Field name="reserved" length="4" encoding="bslbf"/>
                                    <Field name="ES_info_length" length="12" encoding="uimsbf"/>
                                    <Loop name="ES_info_loop" length_field="ES_info_length">
                                        <LoopPresentation>
                                            <LoopHeader str="基本流信息描述"/>
                                            <LoopEmpty str="***无基本流信息描述***"/>
                                        </LoopPresentation>
                                        <Body>
                                            <Descriptor/>
                                        </Body>
                                    </Loop>
                                </Body>
                            </Loop>
                        </Then>
                    </If>
                </Body>
            </Loop>
            <Field name="signature_length" length="16" encoding="uimsbf"/>
            <Field name="signature_data_bytes" length_field="signature_length" encoding="octets">
                <FieldPresentation>
                    <Prefix str="数字签名"/>
                    <Format str="compact, lowercase"/>
                </FieldPresentation>
            </Field>
            <Field name="CRC_32" length="32" encoding="checksum">
                <FieldPresentation>
                    <Format str="%08X"/>
                </FieldPresentation>
            </Field>
        </TableBody>
        <UniqueKey>
            <FieldRef field="table_id"/>
            <FieldRef field="table_id_ext"/>
            <FieldRef field="version_number"/>
            <FieldRef field="section_number"/>
        </UniqueKey>
    </TableTemplate>
</M2TKTemplate>